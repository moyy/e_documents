- [纹理采样：Wrap & Filter](#纹理采样wrap--filter)
  - [1. WebGL-NPOT: 非2的冥尺寸 纹理 限制](#1-webgl-npot-非2的冥尺寸-纹理-限制)
  - [2. texImage2D 和 纹理 宽 高 限制](#2-teximage2d-和-纹理-宽-高-限制)
  - [3. 关于 wrap：解决当纹理坐标 < 0, 或者 > 1 时候，采样纹理点的问题；](#3-关于-wrap解决当纹理坐标--0-或者--1-时候采样纹理点的问题)
  - [4. 关于 filter：解决 当 三角形 视图 大于纹理 或 小于纹理 的时候 的 锯齿问题](#4-关于-filter解决-当-三角形-视图-大于纹理-或-小于纹理-的时候-的-锯齿问题)
  - [5. 纹理：Alpha 预乘](#5-纹理alpha-预乘)

# 纹理采样：Wrap & Filter

## 1. WebGL-NPOT: 非2的冥尺寸 纹理 限制

[WebGL-NPOT: 非2的冥尺寸 纹理 限制](https://www.khronos.org/webgl/wiki/WebGL_and_OpenGL_Differences#Non-Power_of_Two_Texture_Support)

+ generateMipmap 生成 mipmap，第0级的图像宽、高 必须是2的冥
+ **不满足** 以下条件，采样非2的冥的纹理，结果是：(0, 0, 0, 1)
	- repeat 必须设置为：CLAMP_TO_EDGE
	- min-filter 必须 设置为：NEAREST、LINEAR（ 换句话，不能用带 mipmap 的 小-过滤 )

## 2. texImage2D 和 纹理 宽 高 限制

一般来说，纹理宽度：4 的 倍 数；（存疑问？）

原因：glTexImage2D的data，受 glPixelStorge(unpack, 对齐字节数，默认是4字节) 的 影响；

* 如果纹理格式是r8g8b8，每个像素3个字节，但是解码的时候，默认情况，对齐4字节，空间不够，就会崩溃；
* 不是所有显卡驱动的实现，都像浏览器那样兼容性很强的；
* 如果要传r8g8b8，那么两种办法：
	+ 保证 纹理的 宽度 和 高度（稳妥起见而已，其实高度不一定需要） 都是4的倍数，那样不管glPixelStorge填多少，都影响全局；

## 3. 关于 wrap：解决当纹理坐标 < 0, 或者 > 1 时候，采样纹理点的问题；

* 一般情况下：wrap 填 clap-to-edge，不要填 平铺模式；
* 如果 要 平铺模式，那么要确保：纹理上下边缘，左右边缘 能 无缝对齐；否则 边缘 在 Linear的时候有问题

## 4. 关于 filter：解决 当 三角形 视图 大于纹理 或 小于纹理 的时候 的 锯齿问题

* 如果是字体这种 动态生成的纹理，保证一一对应的，最好用：点过滤；0
* 如果是图片，而且移动端不能保证设计稿的目标大小，为了让图片平滑，最好用linear过滤；
* 如果 三角形特别小时（小于2倍纹理大小时），linear过滤也不行，得开mipmap；否则：
	* 采样会严重失真（之前 GUI 迈过坑）
	* 移动时候，会有 闪烁：当minify时，一个pixel"覆盖"多个texel，相邻的两个pixel取的texel太远，在纹理图上可能是两个完全不相邻、完全没有关系的像素。对于高频图像，大量信息被压缩在相对比较小的空间中，则像素变化微小时，色彩变化会剧烈，这个问题在物理上叫做高频走样。在绘制地板和远处物体时会由于这个原因，导致波纹和闪烁（`sparkling`）。

## 5. 纹理：Alpha 预乘

为了解决上面filter的问题，比较统一的方式是在png或jpg中做一次alpha预乘；然后在gui中的混合模式；